var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{c as s,a,r,t as n,b as o,j as i,V as l,R as c,d,A as u,C as m,X as h,T as p,D as g,P as x,e as f,$ as y,f as v,g as b,u as w,h as j,i as N,k as C,v as k,S,M,l as R,m as E,n as _,H as L,B as T,o as A,F as P,p as I,L as z,I as D,q as O,s as V,w as F,x as $,Z as U,y as H,z as W,E as B,N as K,G as Y,J as q,K as X,O as G,Q as Z,U as J,W as Q,Y as ee,_ as te,a0 as se,a1 as ae,a2 as re,a3 as ne,a4 as oe,a5 as ie,a6 as le,a7 as ce,a8 as de,a9 as ue,aa as me,ab as he,ac as pe,ad as ge,ae as xe,af as fe,ag as ye,ah as ve,ai as be,aj as we}from"./vendor-B8s09rVE.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const je=s({name:"map",initialState:{currentLayer:"vector",mapRef:null,contextMenu:null},reducers:{setCurrentLayer:(e,t)=>{e.currentLayer=t.payload},setMapRef:(e,t)=>{e.mapRef=t.payload},setContextMenu:(e,t)=>{e.contextMenu=t.payload},closeContextMenu:e=>{e.contextMenu&&(e.contextMenu.isOpen=!1)}}}),{setCurrentLayer:Ne,setMapRef:Ce,setContextMenu:ke,closeContextMenu:Se}=je.actions,Me=je.reducer,Re=s({name:"ui",initialState:{isSidebarOpen:!1,isPlaceDetailCollapsed:!1,showDirections:!1},reducers:{setSidebarOpen:(e,t)=>{e.isSidebarOpen=t.payload},toggleSidebar:e=>{e.isSidebarOpen=!e.isSidebarOpen},setPlaceDetailCollapsed:(e,t)=>{e.isPlaceDetailCollapsed=t.payload},setShowDirections:(e,t)=>{e.showDirections=t.payload}}}),{setSidebarOpen:Ee,toggleSidebar:_e,setPlaceDetailCollapsed:Le,setShowDirections:Te}=Re.actions,Ae=Re.reducer,Pe=s({name:"location",initialState:{selectedPlace:null,locationInfo:null,startingPlace:null},reducers:{setSelectedPlace:(e,t)=>{e.selectedPlace=t.payload},setLocationInfo:(e,t)=>{e.locationInfo=t.payload},setStartingPlace:(e,t)=>{e.startingPlace=t.payload},clearAllLocations:e=>{e.selectedPlace=null,e.locationInfo=null,e.startingPlace=null}}}),{setSelectedPlace:Ie,setLocationInfo:ze,setStartingPlace:De,clearAllLocations:Oe}=Pe.actions,Ve=a({reducer:{map:Me,ui:Ae,location:Pe.reducer},middleware:e=>e({serializableCheck:{ignoredActions:["map/setMapRef"],ignoredPaths:["map.mapRef"]}})});let Fe=0;const $e=new Map,Ue=e=>{if($e.has(e))return;const t=setTimeout((()=>{$e.delete(e),Ke({type:"REMOVE_TOAST",toastId:e})}),1e6);$e.set(e,t)},He=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map((e=>e.id===t.toast.id?{...e,...t.toast}:e))};case"DISMISS_TOAST":{const{toastId:s}=t;return s?Ue(s):e.toasts.forEach((e=>{Ue(e.id)})),{...e,toasts:e.toasts.map((e=>e.id===s||void 0===s?{...e,open:!1}:e))}}case"REMOVE_TOAST":return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter((e=>e.id!==t.toastId))}}},We=[];let Be={toasts:[]};function Ke(e){Be=He(Be,e),We.forEach((e=>{e(Be)}))}function Ye({...e}){const t=(Fe=(Fe+1)%Number.MAX_SAFE_INTEGER,Fe.toString()),s=()=>Ke({type:"DISMISS_TOAST",toastId:t});return Ke({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||s()}}}),{id:t,dismiss:s,update:e=>Ke({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function qe(...e){return n(o(e))}const Xe=x,Ge=r.forwardRef((({className:e,...t},s)=>i.jsx(l,{ref:s,className:qe("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t})));Ge.displayName=l.displayName;const Ze=d("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Je=r.forwardRef((({className:e,variant:t,...s},a)=>i.jsx(c,{ref:a,className:qe(Ze({variant:t}),e),...s})));Je.displayName=c.displayName,r.forwardRef((({className:e,...t},s)=>i.jsx(u,{ref:s,className:qe("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t}))).displayName=u.displayName;const Qe=r.forwardRef((({className:e,...t},s)=>i.jsx(m,{ref:s,className:qe("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:i.jsx(h,{className:"h-4 w-4"})})));Qe.displayName=m.displayName;const et=r.forwardRef((({className:e,...t},s)=>i.jsx(p,{ref:s,className:qe("text-sm font-semibold",e),...t})));et.displayName=p.displayName;const tt=r.forwardRef((({className:e,...t},s)=>i.jsx(g,{ref:s,className:qe("text-sm opacity-90",e),...t})));function st(){const{toasts:e}=function(){const[e,t]=r.useState(Be);return r.useEffect((()=>(We.push(t),()=>{const e=We.indexOf(t);e>-1&&We.splice(e,1)})),[e]),{...e,toast:Ye,dismiss:e=>Ke({type:"DISMISS_TOAST",toastId:e})}}();return i.jsxs(Xe,{children:[e.map((function({id:e,title:t,description:s,action:a,...r}){return i.jsxs(Je,{...r,children:[i.jsxs("div",{className:"grid gap-1",children:[t&&i.jsx(et,{children:t}),s&&i.jsx(tt,{children:s})]}),a,i.jsx(Qe,{})]},e)})),i.jsx(Ge,{})]})}tt.displayName=g.displayName;const at=({...e})=>{const{theme:t="system"}=f();return i.jsx(y,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})},rt=b;r.forwardRef((({className:e,sideOffset:t=4,...s},a)=>i.jsx(v,{ref:a,sideOffset:t,className:qe("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s}))).displayName=v.displayName;class nt{static initialize(){this.isInitialized||(this.overrideConsole(),this.isInitialized=!0)}static overrideConsole(){this.originalConsole={log:console.log,warn:console.warn,error:console.error,info:console.info,debug:console.debug,clear:console.clear,table:console.table,group:console.group,groupEnd:console.groupEnd},this.showWelcomeMessage(),console.info=console.log,console.debug=console.log,console.clear=()=>{this.originalConsole.clear()},this.showWelcomeMessage()}static showWelcomeMessage(){const e="color: #FF6B6B; font-size: 28px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);",t="color: #4ECDC4; font-size: 16px; font-weight: bold;",s="color: #45B7D1; font-size: 14px;",a="color: #96CEB4; font-size: 14px; font-weight: bold;",r="color: #FFEAA7; font-size: 14px; background: rgba(255, 234, 167, 0.1); padding: 5px;";console.clear(),console.log("%c🗺️ VIETMAP API",e),console.log("%c═══════════════════════════════════════",t),console.log("%cGiải pháp bản đồ số đa nền tảng!!!",s),console.log(""),console.log("%c🎯 Tại sao chọn Vietmap?",t),console.log("%c• 🇻🇳 Dữ liệu bản đồ Việt Nam chuẩn xác nhất",s),console.log("%c• ⚡ API nhanh, ổn định, dễ tích hợp",s),console.log("%c• 💰 Giá cả phải chăng cho startup Việt",s),console.log("%c• 🛠️ SDK đầy đủ: JS, TS, React, Flutter, React Native, Kotlin Multiplatform, Android, iOS",s),console.log("%c• 📱 Autocomplete, Search, Geocoding, Routing, Places API, Matrix, TSP, VRP",s),console.log(""),console.log("%c🔥 Dùng thử miễn phí:",r),console.log("%chttps://maps.vietmap.vn",a),console.log("%cmaps-api.support@vietmap.vn",s),console.log("%c═══════════════════════════════════════",t),console.log("%c📚 Tài liệu API:",r),console.log("%chttps://maps.vietmap.vn/docs",a),console.log("%c💬 Hỗ trợ kỹ thuật:",r),console.log("%chttps://zalo.me/vietmapmapsapi",a),console.log("%c📱 Facebook:",r),console.log("%chttps://www.facebook.com/VietmapSolutions",a),console.log("%c🐱 GitHub:",r),console.log("%chttps://github.com/vietmap-company",a),console.log("%c📺 YouTube:",r),console.log("%chttps://www.youtube.com/@VietmapSolutions",a),console.log("%c🗺️ VIETMAP API",e),console.log("%c═══════════════════════════════════════",t),console.log("%cChào dev! 👋 Bạn đang inspect trang web à?",s),console.log("%cVậy thì đừng quên check out Vietmap API nhé! 🚀",a),console.log(""),console.log("%c🚀 Kéo lên trên để biết thêm chi tiết!",t)}static disableManualRequests(){this.originalFetch=window.fetch,this.originalXHR=window.XMLHttpRequest;let e=!1;window.fetch=(...e)=>{const t=(new Error).stack||"";return t.includes("eval")||t.includes("<anonymous>")||t.split("\n").length,this.originalFetch.apply(window,e)},window.XMLHttpRequest=class extends XMLHttpRequest{open(t,s,a,r,n){const o=(new Error).stack||"";if((o.includes("eval")||o.includes("<anonymous>")||o.split("\n").length<5)&&!e)throw new Error("Manual XMLHttpRequest blocked by Security Manager");return super.open(t,s,a,r,n)}};const t=document.createElement;document.createElement=function(e,...s){if("script"===e.toLowerCase()){const e=(new Error).stack||"";if(e.includes("eval")||e.includes("<anonymous>"))throw new Error("Manual script creation blocked by Security Manager")}return t.call(document,e,...s)},window.__markInternalCall=()=>{e=!0,setTimeout((()=>{e=!1}),0)}}static addAntiDebugging(){let e={open:!1};setInterval((()=>{window.outerHeight-window.innerHeight>160||window.outerWidth-window.innerWidth>160?e.open||(e.open=!0,this.showWelcomeMessage(),Promise.reject(new Error("Manual requests blocked by Security Manager"))):e.open=!1}),500),document.addEventListener("keydown",(e=>{("F12"===e.key||e.ctrlKey&&e.shiftKey&&"I"===e.key||e.ctrlKey&&"u"===e.key||e.ctrlKey&&e.shiftKey&&"C"===e.key)&&(e.preventDefault(),e.key)})),setInterval((()=>{performance.now();debugger;performance.now()}),2e3)}static restore(){this.isInitialized&&(Object.assign(console,this.originalConsole),this.originalFetch&&(window.fetch=this.originalFetch),this.originalXHR&&(window.XMLHttpRequest=this.originalXHR),this.isInitialized=!1)}}t(nt,"isInitialized",!1),t(nt,"originalConsole",{}),t(nt,"originalFetch"),t(nt,"originalXHR");const ot=()=>w(),it=j,lt={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},ct=["aHR0cHM6Ly9tYXBzLnZpZXRtYXAudm4vYXBp","NTA2ODYyYmIwM2EzZDcxNjMyYmRlYjc2NzRhMzYyNTMyOGNiN2U1YTliMDExODQx","eW91ci1obWFjLXNlY3JldC1rZXk=","MjEuMDI4NSwxMDUuODM0Mg=="],dt=()=>{const e="undefined"!=typeof window&&"localhost"!==window.location.hostname&&!window.location.hostname.includes("127.0.0.1")&&!window.location.hostname.includes(".local");return console.log("Environment detection:",{hostname:"undefined"!=typeof window?window.location.hostname:"server",isProduction:e}),e},ut=(e,t,s)=>{let a;return dt()?(a=function(e){try{const t=atob(ct[e]);return console.log(`Decoded index ${e}:`,t),t}catch(t){return console.error(`Failed to decode index ${e}:`,t),""}}(s),console.log(`Production mode - using obfuscated value for ${e}:`,a?"Found":"Empty")):(a=lt[e]||t,console.log(`Development mode - using env var ${e}:`,a?"Found":"Using fallback")),a},mt={VIETMAP_API_KEY:ut("VITE_VIETMAP_API_KEY","506862bb03a3d71632bdeb7674a3625328cb7e5a9b011841",1),VIETMAP_BASE_URL:ut("VITE_VIETMAP_BASE_URL","https://maps.vietmap.vn/api",0),HMAC_SECRET:ut("VITE_HMAC_SECRET","your-hmac-secret-key",2),FOCUS_COORDINATES:ut("VITE_FOCUS_COORDINATES","21.0285,105.8342",3)};console.log("Final ENV configuration:",{VIETMAP_API_KEY:mt.VIETMAP_API_KEY?"Present":"Missing",VIETMAP_BASE_URL:mt.VIETMAP_BASE_URL?"Present":"Missing",HMAC_SECRET:mt.HMAC_SECRET?"Present":"Missing",FOCUS_COORDINATES:mt.FOCUS_COORDINATES?"Present":"Missing"}),dt()&&Object.keys(lt).forEach((e=>{if(e.startsWith("VITE_"))try{delete lt[e]}catch{}}));const ht=class e{constructor(){t(this,"_0x3f8d");const e=mt.HMAC_SECRET;this._0x3f8d=this._0x7b2a(this._0x9d4e(e))}static getInstance(){return e._0x1e9c||(e._0x1e9c=new e),e._0x1e9c}_0x9d4e(e){return btoa(e.split("").map(((e,t)=>String.fromCharCode(e.charCodeAt(0)^t+42))).join(""))}_0x7b2a(e){return atob(e).split("").map(((e,t)=>String.fromCharCode(e.charCodeAt(0)^t+42))).join("")}generateHMAC(e,t,s,a){const r=`${e.toUpperCase()}|${t}|${s}${a?`|${a}`:""}`;return N.HmacSHA256(r,this._0x3f8d).toString(N.enc.Hex)}generateAuthHeaders(e,t,s){const a=Date.now(),r=this.generateHMAC(e,t,a,s);return{[atob("WC1UaW1lc3RhbXA=")]:a.toString(),[atob("WC1TaWduYXR1cmU=")]:r,[atob("WC1BUEktVmVyc2lvbg==")]:atob("MS4w")}}validateResponse(e,t){return e===t}};t(ht,"_0x1e9c");let pt=ht;const gt=class e{constructor(){t(this,"_0x3b7e"),t(this,"_0x5c9a"),t(this,"_0x8d2f"),this._0x3b7e=this._0x6e1b(mt.VIETMAP_BASE_URL),this._0x5c9a=this._0x4a8c(mt.VIETMAP_API_KEY),this._0x8d2f=pt.getInstance()}static getInstance(){return e._0x1f4d||(e._0x1f4d=new e),e._0x1f4d}_0x6e1b(e){return e.split("").map(((e,t)=>String.fromCharCode(e.charCodeAt(0)^t%7))).join("").split("").map(((e,t)=>String.fromCharCode(e.charCodeAt(0)^t%7))).join("")}_0x4a8c(e){return e.split("").reverse().join("").split("").reverse().join("")}_0x2d8f(e,t){const s=new URL(`${this._0x3b7e}${e}`);return s.searchParams.append(atob("YXBpa2V5"),this._0x5c9a),t&&Object.entries(t).forEach((([e,t])=>{s.searchParams.append(e,t)})),s.toString()}isDesktop(){const e=navigator.userAgent||navigator.vendor||window.opera;return!/android|iphone|ipad|ipod|windows phone|mobile/i.test(e)}async makeRequest(e,t,s,a){const r=this._0x2d8f(t,s),n=a?JSON.stringify(a):void 0,o=this._0x8d2f.generateAuthHeaders(e,r,n),i={[atob("Q29udGVudC1UeXBl")]:atob("YXBwbGljYXRpb24vanNvbg=="),...o};if(await new Promise((e=>setTimeout(e,500))),this.isDesktop()&&(window.outerHeight-window.innerHeight>160||window.outerWidth-window.innerWidth>160))return Promise.reject();try{const t=await fetch(r,{method:e,headers:i,body:n});if(!t.ok)throw new Error(`API request failed: ${t.status} ${t.statusText}`);return await t.json()}catch(l){throw console.error(`API request error for ${t}:`,l),l}}async get(e,t){return this.makeRequest("GET",e,t)}async post(e,t,s){return this.makeRequest("POST",e,s,t)}};t(gt,"_0x1f4d");let xt=gt;const ft=new class{constructor(e={}){t(this,"secureClient"),t(this,"config"),this.secureClient=xt.getInstance(),this.config={useProxy:!1,proxyBaseUrl:"/api",...e}}async makeRequest(e,t,s,a){return this.config.useProxy?this.proxyRequest(e,t,s,a):this.secureClient.makeRequest(e,t,s,a)}async proxyRequest(e,t,s,a){const r=`${this.config.proxyBaseUrl}/proxy`,n={method:e,endpoint:t,params:s,body:a},o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!o.ok)throw new Error(`Proxy request failed: ${o.status} ${o.statusText}`);return o.json()}async get(e,t){return this.makeRequest("GET",e,t)}async post(e,t,s){return this.makeRequest("POST",e,s,t)}async put(e,t,s){return this.makeRequest("PUT",e,s,t)}async delete(e,t){return this.makeRequest("DELETE",e,t)}setProxyMode(e,t){this.config.useProxy=e,t&&(this.config.proxyBaseUrl=t)}},yt=async(e,t)=>{try{const s=await ft.get("/reverse/v3",{lng:e.toString(),lat:t.toString()});if(!s.length)throw new Error("No location data found");return{display:s[0].display,name:s[0].name,hs_num:s[0].name.split(" ")[0]||"",street:s[0].name.split(" ").slice(1).join(" ")||"",address:s[0].address,city_id:s[0].boundaries.find((e=>0===e.type))?.id||0,city:s[0].boundaries.find((e=>0===e.type))?.name||"",district_id:s[0].boundaries.find((e=>1===e.type))?.id||0,district:s[0].boundaries.find((e=>1===e.type))?.name||"",ward_id:s[0].boundaries.find((e=>2===e.type))?.id||0,ward:s[0].boundaries.find((e=>2===e.type))?.name||"",lat:s[0].lat,lng:s[0].lng,ref_id:s[0].ref_id||""}}catch(s){throw console.error("Error getting reverse geocoding:",s),s}},vt=(e,t)=>{const s=ot();r.useEffect((()=>{(async()=>{const a=new URLSearchParams(window.location.search).get("placeId");if(a)try{console.log("Loading place from URL parameter:",a);const r=await ft.get("/place/v3",{refid:a});console.log("Loaded place details from URL:",r),s(ze(r)),s(Ie(null)),s(Le(!1)),s(Te(!1)),t&&t(r),e?.current&&(e.current.flyTo(r.lng,r.lat),e.current.addMarker(r.lng,r.lat));const n=new URL(window.location.href);n.searchParams.delete("placeId"),window.history.replaceState({},"",n.toString())}catch(r){console.error("Error loading place from URL:",r),Ye({title:"Lỗi tải địa điểm",description:"Không thể tải thông tin địa điểm từ liên kết",variant:"destructive"});const e=new URL(window.location.href);e.searchParams.delete("placeId"),window.history.replaceState({},"",e.toString())}})(),(async()=>{const a=new URLSearchParams(window.location.search),r=parseFloat(a.get("lat")||""),n=parseFloat(a.get("lng")||"");if(!isNaN(r)&&!isNaN(n)&&(console.log("Loading lat/lng from URL parameters:",r,n),e?.current)){e.current.flyTo(n,r),e.current.addMarker(n,r),s(Ie(null)),s(Le(!1)),s(Te(!1));const a=await ft.get("/reverse/v3",{lng:n.toString(),lat:r.toString()});if(a&&a.length>0){const e={display:a[0].display,name:a[0].name,hs_num:a[0].name.split(" ")[0]||"",street:a[0].name.split(" ").slice(1).join(" ")||"",address:a[0].address,city_id:a[0].boundaries.find((e=>0===e.type))?.id||0,city:a[0].boundaries.find((e=>0===e.type))?.name||"",district_id:a[0].boundaries.find((e=>1===e.type))?.id||0,district:a[0].boundaries.find((e=>1===e.type))?.name||"",ward_id:a[0].boundaries.find((e=>2===e.type))?.id||0,ward:a[0].boundaries.find((e=>2===e.type))?.name||"",lat:a[0].lat,lng:a[0].lng,ref_id:a[0].ref_id||""};console.log("Loaded place details from lat/lng:",e),s(ze(e)),t&&t(e);const r=new URL(window.location.href);r.searchParams.delete("lat"),r.searchParams.delete("lng"),window.history.replaceState({},"",r.toString())}}})()}),[s,e,t])},bt=new class{constructor(){t(this,"getVietMapLightRasterTileLayer",(()=>({version:8,sources:{raster_vm:{type:"raster",tiles:[`https://maps.vietmap.vn/api/lm/{z}/{x}/{y}@2x.png?apikey=${this.getApiKey()}`],tileSize:256,attribution:"Vietmap@copyright"}},layers:[{id:"layer_raster_vm",type:"raster",source:"raster_vm",minzoom:0,maxzoom:20}]}))),t(this,"getVietMapDarkRasterTileLayer",(()=>({version:8,sources:{raster_vm:{type:"raster",tiles:[`https://maps.vietmap.vn/api/dm/{z}/{x}/{y}@2x.png?apikey=${this.getApiKey()}`],tileSize:256,attribution:"Vietmap@copyright"}},layers:[{id:"layer_raster_vm",type:"raster",source:"raster_vm",minzoom:0,maxzoom:20}]}))),t(this,"getVietMapRasterTileLayer",(()=>({version:8,sources:{raster_vm:{type:"raster",tiles:[`https://maps.vietmap.vn/api/tm/{z}/{x}/{y}@2x.png?apikey=${this.getApiKey()}`],tileSize:256,attribution:"Vietmap@copyright"}},layers:[{id:"layer_raster_vm",type:"raster",source:"raster_vm",minzoom:0,maxzoom:20}]}))),t(this,"getVietMapHybridRasterTileLayer",(()=>({version:8,sources:{raster_vm:{type:"raster",tiles:[`https://maps.vietmap.vn/api/hm/{z}/{x}/{y}@2x.png?apikey=${this.getApiKey()}`],tileSize:256,attribution:"Vietmap@copyright"},"satellite-tile":{type:"raster",tiles:["https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}"],tileSize:256}},layers:[{id:"layer_satellite_vm",type:"raster",source:"satellite-tile",minzoom:0,maxzoom:20},{id:"layer_raster_vm",type:"raster",source:"raster_vm",minzoom:0,maxzoom:20}]}))),t(this,"getVietMapSatelliteTileLayer",(()=>({version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}"],tileSize:256}},layers:[{id:"satellite-tile",type:"raster",source:"raster-tiles",minzoom:0,maxzoom:20}]}))),t(this,"getVietMapVectorTile",(()=>{const e=`https://maps.vietmap.vn/mt/tm/style.json?apikey=${this.getApiKey()}`;return console.log("Vector tile URL:",e),e})),t(this,"getVietMapVectorDarkTile",(()=>{const e=`https://maps.vietmap.vn/mt/dm/style.json?apikey=${this.getApiKey()}`;return console.log("Vector dark tile URL:",e),e})),t(this,"getVietMapLightVectorTile",(()=>{const e=`https://maps.vietmap.vn/mt/lm/style.json?apikey=${this.getApiKey()}`;return console.log("Light vector tile URL:",e),e}))}getApiKey(){const e=mt.VIETMAP_API_KEY;return console.log("MapUtils using API key:",e?"Present":"Missing"),e}},wt=r.forwardRef((({className:e="",onContextMenu:t,onClick:s,initialMapStyle:a="vector",onMapStyleChange:n},o)=>{const l=r.useRef(null),c=r.useRef(null),d=r.useRef([]),u=r.useRef([]),[m,h]=r.useState(!1),[p,g]=r.useState(a),[x,f]=r.useState(!1),y=r.useRef(null),v=r.useRef(null),b=["#0071bc","#d92f88","#f7941d","#39b54a","#662d91","#ed1c24"],w=r.useRef(!1),j=r.useRef(null),N=r.useCallback((e=>{2===e.originalEvent.button?w.current=!1:0===e.originalEvent.button&&s&&(j.current=[e.point.x,e.point.y],w.current=!1)}),[s]),C=r.useCallback((()=>{w.current=!0}),[]),S=r.useCallback((e=>{e.preventDefault(),!w.current&&t&&t({lngLat:[e.lngLat.lng,e.lngLat.lat]}),w.current=!1}),[t]),M=r.useCallback((e=>{if(0===e.originalEvent.button&&!w.current&&j.current&&s){const t=[e.point.x,e.point.y],a=j.current,r=t[0]-a[0],n=t[1]-a[1];Math.sqrt(r*r+n*n)<5&&s({lngLat:[e.lngLat.lng,e.lngLat.lat]})}j.current=null,w.current=!1}),[s]),R=e=>{switch(e){case"light":return bt.getVietMapLightRasterTileLayer();case"dark":return bt.getVietMapDarkRasterTileLayer();case"raster":return bt.getVietMapRasterTileLayer();case"hybrid":return bt.getVietMapHybridRasterTileLayer();case"satellite":return bt.getVietMapSatelliteTileLayer();case"vector-light":return bt.getVietMapLightVectorTile();case"vector-dark":return bt.getVietMapVectorDarkTile();default:return bt.getVietMapVectorTile()}};return r.useImperativeHandle(o,(()=>({map:c.current,flyTo:(e,t)=>{c.current&&c.current.flyTo({center:[e,t],zoom:14,essential:!0,duration:500})},getCenter:()=>{if(c.current){const e=c.current.getCenter();return[e.lng,e.lat]}return null},addMarker:(e,t,s="default",a=!1,r)=>{if(c.current){const n={default:"#FF0000",start:"#00FF00",end:"#0000FF",waypoint:"#FFA500"},o=new k.Marker({color:n[s],draggable:a}).setLngLat([e,t]).addTo(c.current);a&&"number"==typeof r&&o.on("dragend",(()=>{const e=o.getLngLat();v.current&&v.current(r,e.lng,e.lat)})),d.current.push({marker:o,index:r})}},removeMarkers:()=>{d.current.forEach((({marker:e})=>e.remove())),d.current=[]},addRoute:(e,t="route",s)=>{if(c.current){const a=s||b[u.current.length%b.length];if(c.current.getSource(t)){const s=c.current.getSource(t);s&&s instanceof k.GeoJSONSource&&"function"==typeof s.setData&&(s.setData({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:e}}),c.current.getLayer(t)&&c.current.setPaintProperty(t,"line-color",a))}else c.current.addSource(t,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:e}}}),c.current.addLayer({id:t,type:"line",source:t,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":a,"line-width":4}},"boundary_province"),u.current.push(t)}},removeRoutes:()=>{c.current&&(u.current.forEach((e=>{c.current.getLayer(e)&&c.current.removeLayer(e),c.current.getSource(e)&&c.current.removeSource(e)})),u.current=[])},fitBounds:e=>{c.current&&c.current.fitBounds(e,{padding:50})},highlightRoute:e=>{c.current&&(u.current.forEach((e=>{c.current.getLayer(e)&&(c.current.setPaintProperty(e,"line-opacity",.5),c.current.setPaintProperty(e,"line-width",3))})),c.current.getLayer(e)&&(c.current.setPaintProperty(e,"line-opacity",1),c.current.setPaintProperty(e,"line-width",5)))},setMapStyle:e=>{if(c.current){const t=R(e);c.current.setStyle(t),g(e),n&&n(e)}},rotateMap:e=>{c.current&&c.current.rotateTo(e,{duration:300})},resetNorth:()=>{c.current&&c.current.resetNorth({duration:300})},toggle3D:()=>{if(c.current){const e=x?0:60;c.current.easeTo({pitch:e,duration:300}),f(!x)}},getCurrentLocation:async()=>new Promise((e=>{navigator.geolocation?navigator.geolocation.getCurrentPosition((t=>{const{longitude:s,latitude:a}=t.coords;c.current&&(c.current.flyTo({center:[s,a],zoom:16,essential:!0}),y.current&&y.current.remove(),y.current=(new k.Marker).setLngLat([s,a]).addTo(c.current)),e(t)}),(t=>{console.error("Error getting location:",t),e(null)}),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):(console.error("Geolocation is not supported by this browser."),e(null))})),setMarkerDragCallback:e=>{v.current=e}})),[p,n,x]),r.useEffect((()=>{if(!l.current||c.current)return;const e=R(a);return c.current=new k.Map({container:l.current,style:e,center:[105.8342,21.0285],zoom:10}),c.current.on("load",(()=>{h(!0)})),()=>{c.current&&(c.current.remove(),c.current=null)}}),[]),r.useEffect((()=>{if(m&&c.current)return c.current.on("mousedown",N),c.current.on("mousemove",C),c.current.on("contextmenu",S),c.current.on("mouseup",M),()=>{c.current&&(c.current.off("mousedown",N),c.current.off("mousemove",C),c.current.off("contextmenu",S),c.current.off("mouseup",M))}}),[m,N,C,S,M]),i.jsx("div",{ref:l,className:`w-full h-full ${e}`})}));wt.displayName="MapView";const jt=d("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Nt=r.forwardRef((({className:e,variant:t,size:s,asChild:a=!1,...r},n)=>{const o=a?S:"button";return i.jsx(o,{className:qe(jt({variant:t,size:s,className:e})),ref:n,...r})}));Nt.displayName="Button";const Ct=r.forwardRef((({className:e,type:t,...s},a)=>i.jsx("input",{type:t,className:qe("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:a,...s})));Ct.displayName="Input";const kt=({suggestions:e,onSelect:t,isVisible:s,isLoading:a=!1})=>s?a?i.jsx("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 p-4 z-50",children:i.jsxs("div",{className:"flex items-center justify-center py-4",children:[i.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-blue-500 border-t-transparent rounded-full mr-2"}),i.jsx("span",{className:"text-sm text-gray-500",children:"Loading suggestions..."})]})}):0===e.length?i.jsx("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 p-4 z-50",children:i.jsx("div",{className:"py-3 text-center text-sm text-gray-500",children:"No results found"})}):i.jsx("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 max-h-60 overflow-y-auto z-50",children:e.map((e=>i.jsx("div",{className:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>t(e),children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(M,{className:"h-5 w-5 text-gray-400 mt-0.5 flex-shrink-0"}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),i.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:e.address})]})]})},e.ref_id)))}):null,St=xt.getInstance(),Mt=({onMenuToggle:e,isMenuOpen:t,onPlaceSelect:s,onClose:a,mapRef:n})=>{const[o,l]=r.useState(""),[c,d]=r.useState([]),[u,m]=r.useState(!1),[p,g]=r.useState(!1),[x,f]=r.useState(!1),y=r.useRef(),v=r.useRef(null);vt(null,(e=>{l(e.display),m(!1),s&&s(e)}));return r.useEffect((()=>{const e=e=>{v.current&&!v.current.contains(e.target)&&m(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]),r.useEffect((()=>()=>{y.current&&clearTimeout(y.current)}),[]),i.jsxs("div",{className:"absolute top-6 left-6 z-20 flex items-start gap-4",children:[i.jsx(Nt,{variant:"outline",size:"icon",onClick:e,className:"bg-white shadow-md hover:bg-gray-50 flex-shrink-0 w-12 h-12 rounded-lg border-gray-200",children:t?i.jsx(h,{className:"h-7 w-7"}):i.jsx(R,{className:"h-7 w-7"})}),i.jsxs("div",{className:"w-96 relative",ref:v,children:[i.jsxs("div",{className:"relative",children:[i.jsx(E,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 h-5 w-5"}),i.jsx(Ct,{type:"text",placeholder:"Tìm kiếm địa điểm hoặc nhập tọa độ (vd: 21.0285, 105.8342)",value:o,onChange:e=>{const t=e.target.value;l(t),y.current&&clearTimeout(y.current),y.current=setTimeout((()=>{(async e=>{if(!e.trim())return d([]),void m(!1);const t=(e=>{const t=e.trim().match(/^(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)$/);if(t){const e=parseFloat(t[1]),s=parseFloat(t[2]);if(e>=-90&&e<=90&&s>=-180&&s<=180)return{lat:e,lng:s}}return null})(e);if(t)await(async(e,t)=>{g(!0);try{const a=await yt(t,e);s&&s(a),l(a.display),m(!1),console.log("Reverse geocoding result:",a)}catch(a){console.error("Reverse geocoding error:",a),Ye({title:"Lỗi tìm kiếm tọa độ",description:"Không thể tìm thấy thông tin vị trí cho tọa độ này",variant:"destructive"})}finally{g(!1)}})(t.lat,t.lng);else{g(!0);try{const t=n?.current?.getCenter(),s=t?`${t[1]},${t[0]}`:mt.FOCUS_COORDINATES,a=await St.get("/autocomplete/v3",{text:e,focus:s});d(a),m(!0)}catch(a){console.error("Search error:",a),d([]),Ye({title:"Search error",description:"An error occurred during search",variant:"destructive"})}finally{g(!1)}}})(t)}),300)},onFocus:()=>{c.length>0&&m(!0)},className:"pl-12 pr-12 py-3 h-12 bg-white shadow-md border-gray-200 focus-visible:ring-2 focus-visible:ring-blue-500 rounded-lg text-base"}),o&&i.jsx("button",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700",onClick:()=>{l(""),d([]),m(!1),a()},children:i.jsx(h,{className:"h-5 w-5"})}),p&&!x&&i.jsx("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2",children:i.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-blue-500 border-t-transparent rounded-full"})})]}),i.jsx(kt,{suggestions:c,onSelect:async e=>{l(e.display),m(!1);const t=await(async e=>{f(!0);try{const t=await St.get("/place/v3",{refid:e});return t.ref_id=e,console.log("Place details:",t),s&&s(t),t}catch(t){return console.error("Place error:",t),Ye({title:"Error loading place",description:"An error occurred while loading place details",variant:"destructive"}),null}finally{f(!1)}})(e.ref_id);console.log("Selected place details:",t)},isVisible:u,isLoading:x})]})]})},Rt=r.forwardRef((({className:e,orientation:t="horizontal",decorative:s=!0,...a},r)=>i.jsx(_,{ref:r,decorative:s,orientation:t,className:qe("shrink-0 bg-border","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",e),...a})));Rt.displayName=_.displayName;const Et=({isOpen:e,onClose:t})=>{const s=[{icon:L,label:"Trang chủ",url:"https://maps.vietmap.vn/web",color:"text-blue-600"},{icon:T,label:"Tài liệu tích hợp",url:"https://maps.vietmap.vn/docs/",color:"text-green-600"},{icon:A,label:"API Playground",url:"https://maps.vietmap.vn/playground/",color:"text-purple-600"},{icon:P,label:"Blog",url:"https://maps.vietmap.vn/web/blog",color:"text-orange-600"},{icon:I,label:"Bảng giá",url:"https://maps.vietmap.vn/web#pricingSection",color:"text-yellow-600"}],a=[{icon:z,label:"Đăng nhập",url:"https://maps.vietmap.vn/console/"},{icon:D,label:"Trợ giúp & phản hồi",url:"https://maps.vietmap.vn/web#contact-section"}],r=()=>{t&&t()};return e?i.jsx("div",{className:"absolute top-20 left-6 z-30 w-80 bg-white rounded-xl shadow-xl border border-gray-100 overflow-hidden",children:i.jsxs("div",{className:"p-4",children:[i.jsx("div",{className:"space-y-1",children:s.map(((e,t)=>i.jsx(Nt,{variant:"ghost",className:"w-full justify-start gap-4 py-3 px-3 hover:bg-gray-50 text-left h-auto",asChild:!0,children:i.jsxs("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",onClick:r,children:[i.jsx(e.icon,{className:`h-5 w-5 ${e.color} flex-shrink-0`}),i.jsx("span",{className:"text-gray-800 text-sm",children:e.label})]})},t)))}),i.jsx(Rt,{className:"my-4"}),i.jsx("div",{className:"space-y-1",children:a.map(((e,t)=>i.jsx(Nt,{variant:"ghost",className:"w-full justify-start gap-4 py-3 px-3 hover:bg-gray-50 text-left h-auto",asChild:!0,children:i.jsxs("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",onClick:r,children:[i.jsx(e.icon,{className:"h-5 w-5 text-gray-500 flex-shrink-0"}),i.jsx("span",{className:"text-gray-800 text-sm",children:e.label})]})},t)))})]})}):null},_t=({isOpen:e,onClose:t,onLayerSelect:s,currentLayer:a})=>{const n=r.useRef(null);if(r.useEffect((()=>{const s=e=>{n.current&&!n.current.contains(e.target)&&t()},a=e=>{"Escape"===e.key&&t()};return e&&(document.addEventListener("mousedown",s),document.addEventListener("keydown",a)),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("keydown",a)}}),[e,t]),!e)return null;const o=({title:e,layers:t})=>i.jsxs("div",{className:"py-1",children:[i.jsx("div",{className:"px-3 py-1 text-xs font-medium text-gray-500 uppercase tracking-wide",children:e}),t.map((e=>i.jsx("button",{onClick:()=>s(e.id),className:qe("w-full text-left px-3 py-2 text-sm rounded-md transition-colors mx-1",a===e.id?"bg-primary text-primary-foreground":"hover:bg-gray-100"),children:e.name},e.id)))]});return i.jsxs("div",{ref:n,className:"absolute bottom-12 right-20 z-10 w-48 bg-white rounded-lg shadow-lg overflow-hidden border border-gray-200 animate-in fade-in duration-100",children:[i.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-200",children:[i.jsx("h3",{className:"text-sm font-medium",children:"Map Layers"}),i.jsx(Nt,{variant:"ghost",size:"icon",onClick:t,className:"h-6 w-6 rounded-full",children:i.jsx(h,{className:"h-4 w-4"})})]}),i.jsxs("div",{className:"py-1",children:[i.jsx(o,{title:"Vector",layers:[{id:"vector",name:"Vector"},{id:"vector-light",name:"Vector Light"},{id:"vector-dark",name:"Vector Dark"}]}),i.jsx(Rt,{className:"my-1"}),i.jsx(o,{title:"Raster",layers:[{id:"raster",name:"Raster"},{id:"light",name:"Light"},{id:"dark",name:"Dark"}]}),i.jsx(Rt,{className:"my-1"}),i.jsx(o,{title:"Satellite",layers:[{id:"satellite",name:"Satellite"},{id:"hybrid",name:"Hybrid"}]})]})]})},Lt=({mapRef:e,onLayerChange:t,currentLayer:s="vector"})=>{const[a,n]=r.useState(!1),[o,l]=r.useState(!1),[c,d]=r.useState(!1);return i.jsxs("div",{className:"absolute bottom-12 right-6 z-10 flex flex-col gap-3",children:[i.jsx(_t,{isOpen:a,onClose:()=>n(!1),onLayerSelect:e=>{t&&t(e),n(!1)},currentLayer:s}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx(Nt,{variant:"outline",size:"icon",onClick:()=>{e?.current&&(e.current.toggle3D(),l((e=>!e)))},className:(o?"bg-blue-100":"bg-white")+" shadow-lg hover:bg-gray-50 w-10 h-10 rounded-lg border-gray-200",title:"Toggle 3D view",children:i.jsx(O,{className:"h-4 w-4"})}),i.jsx(Nt,{variant:"outline",size:"icon",onClick:()=>{n((e=>!e))},className:"bg-white shadow-lg hover:bg-gray-50 w-10 h-10 rounded-lg border-gray-200",title:"Map layers",children:i.jsx(V,{className:"h-4 w-4"})}),i.jsx(Nt,{variant:"outline",size:"icon",onClick:()=>{if(e?.current){const t=e.current.map?.getBearing()||0;e.current.rotateMap((t+45)%360)}},className:"bg-white shadow-lg hover:bg-gray-50 w-10 h-10 rounded-lg border-gray-200",title:"Rotate map",children:i.jsx(F,{className:"h-4 w-4"})}),i.jsx(Nt,{variant:"outline",size:"icon",onClick:()=>{e?.current&&e.current.resetNorth()},className:"bg-white shadow-lg hover:bg-gray-50 w-10 h-10 rounded-lg border-gray-200",title:"Reset bearing to north",children:i.jsx($,{className:"h-4 w-4"})})]}),i.jsxs("div",{className:"flex flex-col bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden",children:[i.jsx(Nt,{variant:"ghost",size:"icon",onClick:()=>{const t=e?.current?.map;t&&t.zoomIn()},className:"hover:bg-gray-50 w-10 h-10 rounded-none border-b border-gray-200",title:"Zoom in",children:i.jsx(U,{className:"h-4 w-4"})}),i.jsx(Nt,{variant:"ghost",size:"icon",onClick:()=>{const t=e?.current?.map;t&&t.zoomOut()},className:"hover:bg-gray-50 w-10 h-10 rounded-none",title:"Zoom out",children:i.jsx(H,{className:"h-4 w-4"})})]})]})},Tt=({shouldScaleBackground:e=!0,...t})=>i.jsx(W.Root,{shouldScaleBackground:e,...t});Tt.displayName="Drawer";const At=W.Portal,Pt=r.forwardRef((({className:e,...t},s)=>i.jsx(W.Overlay,{ref:s,className:qe("fixed inset-0 z-50 bg-black/80",e),...t})));Pt.displayName=W.Overlay.displayName;const It=r.forwardRef((({className:e,children:t,...s},a)=>i.jsxs(At,{children:[i.jsx(Pt,{}),i.jsxs(W.Content,{ref:a,className:qe("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",e),...s,children:[i.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),t]})]})));It.displayName="DrawerContent";const zt=({className:e,...t})=>i.jsx("div",{className:qe("grid gap-1.5 p-4 text-center sm:text-left",e),...t});zt.displayName="DrawerHeader";const Dt=r.forwardRef((({className:e,...t},s)=>i.jsx(W.Title,{ref:s,className:qe("text-lg font-semibold leading-none tracking-tight",e),...t})));Dt.displayName=W.Title.displayName,r.forwardRef((({className:e,...t},s)=>i.jsx(W.Description,{ref:s,className:qe("text-sm text-muted-foreground",e),...t}))).displayName=W.Description.displayName;const Ot=({place:e,onClose:t,onDirectionClick:s})=>{const[a,n]=r.useState(!1),[o,l]=r.useState(!1);if(r.useEffect((()=>{l(!0);const e=setTimeout((()=>l(!1)),100);return()=>clearTimeout(e)}),[]),!e)return null;const c=(e.display?.split(",")||[]).slice(1).join(",").trim(),d=async()=>{if(console.log("Sharing place:",e),!e.ref_id)return void Ye({title:"Lỗi chia sẻ",description:"Không thể chia sẻ địa điểm này",variant:"destructive"});const t=new URL(window.location.href);t.searchParams.set("placeId",e.ref_id);try{await navigator.clipboard.writeText(t.toString()),Ye({title:"Đã sao chép liên kết",description:"Liên kết địa điểm đã được sao chép vào clipboard"})}catch(s){console.error("Failed to copy to clipboard:",s),Ye({title:"Lỗi sao chép",description:"Không thể sao chép liên kết",variant:"destructive"})}},u=window.innerWidth<=768;return i.jsxs(i.Fragment,{children:[!u&&i.jsx("div",{className:`fixed top-0 left-0 h-full z-40 transition-all duration-100 ${a?"-translate-x-full":"translate-x-0"} ${o?"animate-in fade-in slide-in-from-left duration-100":""}`,children:i.jsx("div",{className:"flex h-full",children:i.jsxs("div",{className:"bg-white shadow-lg pt-0 w-[500px] flex flex-col h-full border-r",children:[i.jsx("div",{className:"w-full h-[250px] bg-cover bg-center relative",style:{backgroundImage:"url('/lovable-uploads/759ebf50-d075-4366-98b3-99771c255fa9.png')"}}),i.jsxs("div",{className:"px-6 py-4",children:[i.jsxs("div",{className:"flex items-start gap-4 py-3",children:[i.jsx(M,{className:"h-5 w-5 text-gray-500 flex-shrink-0 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-gray-900",children:e.display}),i.jsx("p",{className:"text-sm text-gray-600 mt-1",children:c})]})]}),i.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-blue-600",children:[i.jsx(B,{className:"h-4 w-4"}),i.jsxs("button",{className:"hover:underline",children:["Suggest an edit on ",e.name]})]})]}),i.jsx(Rt,{}),i.jsxs("div",{className:"flex justify-between px-6 py-4",children:[i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx(Nt,{variant:"ghost",size:"icon",className:"rounded-full h-12 w-12 bg-blue-50 text-blue-600",onClick:s,children:i.jsx(K,{className:"h-6 w-6"})}),i.jsx("span",{className:"text-xs mt-1",children:"Directions"})]}),i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx(Nt,{variant:"ghost",size:"icon",className:"rounded-full h-12 w-12",children:i.jsx(Y,{className:"h-6 w-6 text-gray-600"})}),i.jsx("span",{className:"text-xs mt-1",children:"Save"})]}),i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx(Nt,{variant:"ghost",size:"icon",className:"rounded-full h-12 w-12",onClick:d,children:i.jsx(q,{className:"h-6 w-6 text-gray-600"})}),i.jsx("span",{className:"text-xs mt-1",children:"Share"})]}),i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx(Nt,{variant:"ghost",size:"icon",className:"rounded-full h-12 w-12",children:i.jsx(X,{className:"h-6 w-6 text-gray-600"})}),i.jsx("span",{className:"text-xs mt-1",children:"Nearby"})]})]}),i.jsx(Rt,{}),i.jsxs("div",{className:"flex-1 overflow-auto",children:[i.jsxs("div",{className:"px-6 py-2",children:[i.jsxs(Nt,{variant:"ghost",className:"w-full justify-start gap-4 py-3 text-left",children:[i.jsx(G,{className:"h-5 w-5 text-gray-500"}),i.jsx("span",{children:"Add a missing place"})]}),i.jsxs(Nt,{variant:"ghost",className:"w-full justify-start gap-4 py-3 text-left",children:[i.jsx(X,{className:"h-5 w-5 text-gray-500"}),i.jsx("span",{children:"Add your business"})]}),i.jsxs(Nt,{variant:"ghost",className:"w-full justify-start gap-4 py-3 text-left",children:[i.jsx(G,{className:"h-5 w-5 text-gray-500"}),i.jsx("span",{children:"Add a label"})]}),i.jsxs(Nt,{variant:"ghost",className:"w-full justify-start gap-4 py-3 text-left",children:[i.jsx(Z,{className:"h-5 w-5 text-gray-500"}),i.jsx("span",{children:"Your Maps activity"})]})]}),i.jsx(Rt,{className:"my-2"}),i.jsxs("div",{className:"px-6 py-2",children:[i.jsx("h3",{className:"text-base font-medium mb-4",children:"At this place"}),i.jsx("p",{className:"text-sm text-gray-500",children:"No additional information available"})]})]})]})})}),!u&&i.jsx("div",{className:"fixed top-1/2 transform -translate-y-1/2 z-40 transition-all duration-100 "+(a?"left-0":"left-[500px]"),children:i.jsx(Nt,{variant:"ghost",size:"icon",className:"h-12 bg-white border border-gray-200 rounded-r-full rounded-l-none shadow-md",onClick:()=>{n(!a)},children:a?i.jsx(J,{className:"h-5 w-5"}):i.jsx(Q,{className:"h-5 w-5"})})}),u&&i.jsx(Tt,{open:!!e,onOpenChange:e=>!e&&t(),children:i.jsxs(It,{className:"h-[85vh] animate-in slide-in-from-bottom duration-100",children:[i.jsx("div",{className:"w-full h-[250px] bg-cover bg-center relative",style:{backgroundImage:"url('/lovable-uploads/759ebf50-d075-4366-98b3-99771c255fa9.png')"},children:i.jsx(Nt,{variant:"outline",size:"icon",onClick:t,className:"absolute top-6 right-6 bg-white rounded-full h-10 w-10 shadow-md",children:i.jsx(h,{className:"h-5 w-5"})})}),i.jsxs(zt,{className:"p-4 border-b",children:[i.jsx(Dt,{children:e.name}),i.jsx("p",{className:"text-sm text-gray-500",children:c})]}),i.jsxs("div",{className:"p-4 overflow-auto",children:[i.jsxs("div",{className:"flex justify-between px-2 py-4",children:[i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx(Nt,{variant:"ghost",size:"icon",className:"rounded-full h-12 w-12 bg-blue-50 text-blue-600",onClick:s,children:i.jsx(K,{className:"h-6 w-6"})}),i.jsx("span",{className:"text-xs mt-1",children:"Directions"})]}),i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx(Nt,{variant:"ghost",size:"icon",className:"rounded-full h-12 w-12",children:i.jsx(Y,{className:"h-6 w-6 text-gray-600"})}),i.jsx("span",{className:"text-xs mt-1",children:"Save"})]}),i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx(Nt,{variant:"ghost",size:"icon",className:"rounded-full h-12 w-12",onClick:d,children:i.jsx(q,{className:"h-6 w-6 text-gray-600"})}),i.jsx("span",{className:"text-xs mt-1",children:"Share"})]})]}),i.jsx(Rt,{}),i.jsxs("div",{className:"px-6 py-4",children:[i.jsxs("div",{className:"flex items-start gap-4 py-3",children:[i.jsx(M,{className:"h-5 w-5 text-gray-500 flex-shrink-0 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-gray-900",children:e.display}),i.jsxs("p",{className:"text-sm text-gray-600",children:[e.city,", Vietnam"]})]})]}),i.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-blue-600",children:[i.jsx(B,{className:"h-4 w-4"}),i.jsxs("button",{className:"hover:underline",children:["Suggest an edit on ",e.name]})]})]}),i.jsx(Rt,{}),i.jsxs("div",{className:"flex-1 overflow-auto",children:[i.jsxs("div",{className:"px-6 py-2",children:[i.jsxs(Nt,{variant:"ghost",className:"w-full justify-start gap-4 py-3 text-left",children:[i.jsx(G,{className:"h-5 w-5 text-gray-500"}),i.jsx("span",{children:"Add a missing place"})]}),i.jsxs(Nt,{variant:"ghost",className:"w-full justify-start gap-4 py-3 text-left",children:[i.jsx(X,{className:"h-5 w-5 text-gray-500"}),i.jsx("span",{children:"Add your business"})]}),i.jsxs(Nt,{variant:"ghost",className:"w-full justify-start gap-4 py-3 text-left",children:[i.jsx(G,{className:"h-5 w-5 text-gray-500"}),i.jsx("span",{children:"Add a label"})]}),i.jsxs(Nt,{variant:"ghost",className:"w-full justify-start gap-4 py-3 text-left",children:[i.jsx(Z,{className:"h-5 w-5 text-gray-500"}),i.jsx("span",{children:"Your Maps activity"})]})]}),i.jsx(Rt,{className:"my-2"}),i.jsxs("div",{className:"px-6 py-2",children:[i.jsx("h3",{className:"text-base font-medium mb-4",children:"At this place"}),i.jsx("p",{className:"text-sm text-gray-500",children:"No additional information available"})]})]})]})]})})]})},Vt=r.forwardRef((({className:e,children:t,...s},a)=>i.jsxs(ee,{ref:a,className:qe("relative overflow-hidden",e),...s,children:[i.jsx(te,{className:"h-full w-full rounded-[inherit]",children:t}),i.jsx(Ft,{}),i.jsx(se,{})]})));Vt.displayName=ee.displayName;const Ft=r.forwardRef((({className:e,orientation:t="vertical",...s},a)=>i.jsx(ae,{ref:a,orientation:t,className:qe("flex touch-none select-none transition-colors","vertical"===t&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...s,children:i.jsx(re,{className:"relative flex-1 rounded-full bg-border"})})));Ft.displayName=ae.displayName;const $t=({path:e,onBack:t})=>i.jsxs("div",{className:"fixed top-0 left-0 h-full z-40 transition-all duration-300 w-[500px] bg-white shadow-lg flex flex-col",children:[i.jsx("div",{className:"w-full h-[150px] bg-cover bg-center relative flex items-center justify-center",style:{backgroundImage:"url('/lovable-uploads/759ebf50-d075-4366-98b3-99771c255fa9.png')"},children:i.jsx(Nt,{variant:"outline",size:"icon",onClick:t,className:"absolute top-6 left-6 bg-white rounded-full h-10 w-10 shadow-md",children:i.jsx(ne,{className:"h-5 w-5"})})}),i.jsxs("div",{className:"px-6 py-4",children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsx("h2",{className:"text-xl font-semibold",children:"Route Details"}),i.jsxs("div",{className:"text-right",children:[i.jsxs("p",{className:"text-sm font-medium",children:[(e.distance/1e3).toFixed(2)," km"]}),i.jsxs("p",{className:"text-sm text-gray-500",children:[Math.round(e.time/6e4)," mins"]})]})]}),i.jsx(Rt,{className:"my-4"})]}),i.jsx(Vt,{className:"flex-1 px-6 pb-6",children:i.jsx("div",{className:"space-y-4 pr-4",children:e.instructions.map(((e,t)=>i.jsxs("div",{className:"py-3 px-4 border-l-2 border-blue-500 hover:bg-gray-50 rounded-r-md",children:[i.jsx("p",{className:"font-medium",children:e.text}),i.jsxs("div",{className:"flex justify-between text-sm text-gray-500 mt-1",children:[i.jsxs("span",{children:[(e.distance/1e3).toFixed(2)," km"]}),i.jsxs("span",{children:[Math.round(e.time/6e4)," mins"]})]}),e.street_name&&i.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[i.jsx("span",{className:"font-medium",children:"Street: "}),e.street_name]})]},t)))})})]}),Ut=({onClose:e})=>i.jsx("div",{className:"w-full h-[150px] bg-cover bg-center relative flex items-center justify-center",style:{backgroundImage:"url('/lovable-uploads/759ebf50-d075-4366-98b3-99771c255fa9.png')"},children:i.jsx(Nt,{variant:"outline",size:"icon",onClick:e,className:"absolute top-6 right-6 bg-white rounded-full h-10 w-10 shadow-md",children:i.jsx(h,{className:"h-5 w-5"})})}),Ht=({vehicle:e,onVehicleChange:t})=>{const s=[{id:"car",icon:i.jsx("span",{children:"🚗"}),label:"Car"},{id:"motorcycle",icon:i.jsx("span",{children:"🏍️"}),label:"Motorcycle"},{id:"bike",icon:i.jsx("span",{children:"🚲"}),label:"Bike"},{id:"foot",icon:i.jsx("span",{children:"🚶"}),label:"Walk"}];return i.jsxs("div",{className:"mb-4",children:[i.jsx("h3",{className:"text-sm font-medium mb-2 mt-[10px] ml-[10px]",children:"Travel mode"}),i.jsx("div",{className:"flex gap-2 px-[30px]",children:s.map((s=>i.jsxs(Nt,{variant:e===s.id?"default":"outline",size:"sm",className:"flex-1",onClick:()=>t(s.id),children:[i.jsx("span",{className:"mr-1",children:s.icon}),i.jsx("span",{children:s.label})]},s.id)))})]})},Wt=({waypoint:e,index:t,totalWaypoints:s,draggedIndex:a,activeInputIndex:r,onInputChange:n,onInputFocus:o,onMoveWaypoint:l,onRemoveWaypoint:c,onDragStart:d,onDragEnd:u,onDragOver:m,onSwapWaypoints:p,inputRef:g})=>{const x=s>2,f=2===s&&0===t&&p;return i.jsxs("div",{className:"relative flex items-center gap-2 "+(a===t?"opacity-50 bg-gray-100":""),draggable:s>2,onDragStart:()=>d(t),onDragEnd:u,onDragOver:e=>m(e,t),children:[s>2&&i.jsxs("div",{className:"flex flex-col",children:[i.jsx(Nt,{variant:"ghost",size:"icon",className:"h-5 w-5 p-0",onClick:()=>l(t,"up"),disabled:0===t,children:i.jsx(oe,{className:"h-4 w-4"})}),i.jsx(Nt,{variant:"ghost",size:"icon",className:"h-5 w-5 p-0",onClick:()=>l(t,"down"),disabled:t===s-1,children:i.jsx(ie,{className:"h-4 w-4"})})]}),i.jsxs("div",{className:"flex-1 relative",children:[i.jsx(Ct,{placeholder:0===t?"Điểm bắt đầu hoặc tọa độ (vd: 21.0285, 105.8342)":t===s-1?"Điểm đến hoặc tọa độ (vd: 21.0285, 105.8342)":"Điểm dừng hoặc tọa độ (vd: 21.0285, 105.8342)",value:e.name,onChange:e=>n(e,t),onFocus:()=>o(t),className:"pl-10 "+(x?"pr-8":"pr-3"),ref:g}),i.jsx(E,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),x&&i.jsx(Nt,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 w-6",onClick:()=>c(t),children:i.jsx(h,{className:"h-4 w-4"})})]}),f&&i.jsx(Nt,{variant:"outline",size:"icon",className:"h-10 w-10 flex-shrink-0",onClick:p,children:i.jsx(le,{className:"h-4 w-4"})})]})},Bt=({routeSummaries:e,selectedRouteId:t,onSelectRoute:s,onShowRouteDetails:a})=>0===e.length?null:i.jsxs("div",{className:"flex-1 overflow-auto px-4 py-2",children:[i.jsx("h3",{className:"font-medium mb-3",children:"Available routes"}),i.jsx("div",{className:"space-y-2",children:e.map((e=>i.jsxs("div",{className:"p-3 border rounded-md cursor-pointer transition-all "+(t===e.id?"border-primary bg-primary/5":"border-gray-200 hover:bg-gray-50"),onClick:()=>s(e.id),children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"w-3 h-10 rounded-full mr-3",style:{backgroundColor:e.color}}),i.jsx("div",{className:"flex-1",children:i.jsxs("div",{className:"flex justify-between",children:[i.jsxs("span",{className:"font-medium",children:[(e.distance/1e3).toFixed(2)," km"]}),i.jsxs("span",{className:"text-gray-600",children:[Math.round(e.time/6e4)," mins"]})]})})]}),t===e.id&&i.jsx("div",{className:"mt-3 flex justify-end",children:i.jsxs(Nt,{variant:"outline",size:"sm",className:"gap-1",onClick:a,children:[i.jsx(ce,{className:"h-4 w-4"}),"View details"]})})]},e.id)))})]}),Kt=xt.getInstance(),Yt=r.forwardRef((({onClose:e,mapRef:t,startingPlace:s,onMapClick:a},n)=>{const[o,l]=r.useState(!0),[c,d]=r.useState([{name:s?.display||"",lat:s?.lat||0,lng:s?.lng||0},{name:"",lat:0,lng:0}]),[u,m]=r.useState(null),[h,p]=r.useState([]),[g,x]=r.useState(!1),[f,y]=r.useState(!1),[v,b]=r.useState("car"),[w,j]=r.useState(null),[N,C]=r.useState(null),[k,S]=r.useState([]),[M,R]=r.useState(null),[E,_]=r.useState(!1),[L,T]=r.useState(null),[A,P]=r.useState(!1),[I,z]=r.useState(null),D=r.useRef([]),O=r.useRef(null),V=r.useRef();r.useEffect((()=>{const e=setTimeout((()=>l(!1)),100);return()=>clearTimeout(e)}),[]),r.useEffect((()=>{I&&(d((e=>e.map(((t,s)=>s===e.length-1?{...t,name:I.display,lat:I.lat,lng:I.lng,ref_id:I.ref_id}:t)))),z(null))}),[I]),r.useEffect((()=>{if(c.length<2)return;const e=c.filter((e=>e&&0!==e.lat&&0!==e.lng));console.log("waypoints:",c),console.log("Valid waypoints:",e),console.log(e.length,c.length),console.log(e.length==c.length),e.length===c.length&&(console.log("Auto-updating route with new coordinates"),setTimeout((()=>{Z()}),100))}),[c]),r.useImperativeHandle(n,(()=>({setEndPoint:e=>{o?z(e):d((t=>t.map(((s,a)=>a===t.length-1?{...s,name:e.display,lat:e.lat,lng:e.lng,ref_id:e.ref_id}:s))))},addWaypoint:e=>{d((t=>{const s=[...t],a={name:e.display,lat:e.lat,lng:e.lng,ref_id:e.ref_id};return s.splice(s.length-1,0,a),s}))},hasValidInputs:()=>c.filter((e=>0!==e.lat&&0!==e.lng)).length>=2,updateWaypointCoordinates:async(e,t,s)=>{try{console.log(`Updating waypoint ${e} to coordinates: ${t}, ${s}`),d((a=>{const r=a.map(((a,r)=>r===e?{...a,lat:s,lng:t}:a));return console.log("Updated waypoints with new coordinates:",r),r}));const a=await Kt.get("/reverse/v3",{lng:t.toString(),lat:s.toString()});console.log("Reverse geocoding response:",a),a.length>0&&(console.log("updating new waypoint",c),d((t=>{const s=t.map(((t,s)=>s===e?{...t,name:a[0].display,ref_id:a[0].ref_id}:t));return console.log("Updated waypoints with location name:",s),s})),console.log("Updated waypoint",c))}catch(a){console.error("Error getting location details:",a),A&&w&&setTimeout((()=>{console.log("Updated waypoint",c),Z()}),100)}}})),[c,A,w,o]);const F=["#0071bc","#d92f88","#f7941d","#39b54a","#662d91","#ed1c24"];r.useEffect((()=>{s&&t.current&&(t.current.flyTo(s.lng,s.lat),t.current.addMarker(s.lng,s.lat,"start"))}),[s]),r.useEffect((()=>{D.current=D.current.slice(0,c.length)}),[c.length]),r.useEffect((()=>()=>{V.current&&clearTimeout(V.current)}),[]),r.useEffect((()=>{const e=e=>{O.current&&!O.current.contains(e.target)&&x(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]);const $=(e,s)=>{const a=e.target.value;d((e=>e.map(((e,t)=>t===s?{...e,name:a}:e)))),m(s),V.current&&clearTimeout(V.current),V.current=setTimeout((()=>{(async e=>{if(!e.trim())return p([]),void x(!1);const s=(e=>{const t=e.trim().match(/^(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)$/);if(t){const e=parseFloat(t[1]),s=parseFloat(t[2]);if(e>=-90&&e<=90&&s>=-180&&s<=180)return{lat:e,lng:s}}return null})(e);if(s&&null!==u)await(async(e,s,a)=>{y(!0);try{const r=await yt(s,e);d((e=>e.map(((e,t)=>t===a?{...e,name:r.display,lat:r.lat,lng:r.lng,ref_id:r.ref_id}:e)))),t.current&&0===a&&t.current.flyTo(r.lng,r.lat),x(!1),m(null),console.log("Reverse geocoding result for waypoint",a,":",r)}catch(r){console.error("Reverse geocoding error:",r),Ye({title:"Lỗi tìm kiếm tọa độ",description:"Không thể tìm thấy thông tin vị trí cho tọa độ này",variant:"destructive"})}finally{y(!1)}})(s.lat,s.lng,u);else{y(!0);try{const s=t?.current?.getCenter(),a=s?`${s[1]},${s[0]}`:mt.FOCUS_COORDINATES,r=await Kt.get("/autocomplete/v3",{text:e,focus:a});p(r),x(!0)}catch(a){console.error("Search error:",a),p([]),Ye({title:"Search error",description:"An error occurred during search",variant:"destructive"})}finally{y(!1)}}})(a)}),300)},U=e=>{m(e)},H=async e=>{null!==u&&(d((t=>t.map(((t,s)=>s===u?{...t,name:e.display}:t)))),await(async(e,s)=>{try{const a=await Kt.get("/place/v3",{refid:e});return d((t=>t.map(((t,r)=>r===s?{...t,name:a.display,lat:a.lat,lng:a.lng,ref_id:e}:t)))),t.current&&0===s&&t.current.flyTo(a.lng,a.lat),a}catch(a){return console.error("Place error:",a),Ye({title:"Error loading place",description:"An error occurred while loading place details",variant:"destructive"}),null}})(e.ref_id,u)),x(!1),m(null)},W=e=>{c.length<=2||d((t=>t.filter(((t,s)=>s!==e))))},B=()=>{2===c.length&&d([c[1],c[0]])},Y=(e,t)=>{"up"===t&&e>0?d((t=>{const s=[...t];return[s[e-1],s[e]]=[s[e],s[e-1]],s})):"down"===t&&e<c.length-1&&d((t=>{const s=[...t];return[s[e],s[e+1]]=[s[e+1],s[e]],s}))},q=e=>{C(e)},X=()=>{C(null)},G=(e,t)=>{e.preventDefault(),null!==N&&N!==t&&(d((e=>{const s=[...e],a=s[N];return s.splice(N,1),s.splice(t,0,a),s})),C(t))},Z=async()=>{const e=c.filter((e=>0!==e.lat&&0!==e.lng));if(console.log("waypoints:",c),console.log("Valid waypoints:",e),e.length<2)Ye({title:"Invalid route",description:"Please select valid start and end locations",variant:"destructive"});else try{const s={"api-version":"1.1",points_encoded:"true",vehicle:v},a=e.map(((e,t)=>`point=${e.lat},${e.lng}`)).join("&");console.log("Direction response:",a);const r=await Kt.get(`/route?${a}`,s);if(j(r),S([]),R(null),t.current&&(t.current.removeRoutes(),t.current.removeMarkers()),r.paths&&r.paths.length>0){const s=[];r.paths.forEach(((e,a)=>{const r=`route-${a}`,n=F[a%F.length],o=function(e){const t=[];let s=0;const a=e.length;let r=0,n=0;for(;s<a;){let a,o=0,i=0;do{a=e.charCodeAt(s++)-63,i|=(31&a)<<o,o+=5}while(a>=32);r+=1&i?~(i>>1):i>>1,o=0,i=0;do{a=e.charCodeAt(s++)-63,i|=(31&a)<<o,o+=5}while(a>=32);n+=1&i?~(i>>1):i>>1,t.push([1e-5*n,1e-5*r])}return t}(e.points);t.current&&t.current.addRoute(o,r,n),s.push({id:r,distance:e.distance,time:e.time,color:n})})),S(s),s.length>0&&(R(s[0].id),t.current&&t.current.highlightRoute(s[0].id)),t.current&&e.forEach(((s,a)=>{const r=0===a,n=a===e.length-1;t.current.addMarker(s.lng,s.lat,r?"start":n?"end":"waypoint",!0,a)}));const a=r.paths[0];if(a.bbox&&4===a.bbox.length&&t.current){const[e,s,r,n]=a.bbox;t.current.fitBounds([[e,s],[r,n]])}P(!0)}Ye({title:`${r.paths.length} route${r.paths.length>1?"s":""} found`,description:"Select a route to see details"})}catch(s){console.error("Direction error:",s),Ye({title:"Error getting directions",description:"An error occurred while calculating the route",variant:"destructive"})}};return E&&L?i.jsx($t,{path:L,onBack:()=>{_(!1),T(null)}}):i.jsx("div",{className:"fixed top-0 left-0 h-full z-40 transition-all duration-100 w-[500px] overflow-auto "+(o?"animate-in fade-in slide-in-from-left duration-100":""),children:i.jsx("div",{className:"flex h-full",children:i.jsxs("div",{className:"bg-white shadow-lg pt-0 w-full flex flex-col border-r",children:[i.jsx(Ut,{onClose:e}),i.jsx(Ht,{vehicle:v,onVehicleChange:b}),i.jsxs("div",{className:"px-6 py-4 relative",ref:O,children:[i.jsx("div",{className:"space-y-3 mb-4",children:c.map(((e,t)=>i.jsxs("div",{children:[i.jsx(Wt,{waypoint:e,index:t,totalWaypoints:c.length,draggedIndex:N,activeInputIndex:u,onInputChange:$,onInputFocus:U,onMoveWaypoint:Y,onRemoveWaypoint:W,onDragStart:q,onDragEnd:X,onDragOver:G,onSwapWaypoints:2===c.length?B:void 0,inputRef:e=>D.current[t]=e}),g&&u===t&&i.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 z-50",children:i.jsx(kt,{suggestions:h,onSelect:H,isVisible:!0,isLoading:f})})]},t)))}),i.jsxs(Nt,{variant:"outline",className:"w-full flex items-center justify-center gap-2",onClick:()=>{d((e=>[...e,{name:"",lat:0,lng:0}]))},children:[i.jsx(de,{className:"h-4 w-4"}),"Add stop"]}),i.jsx(Rt,{className:"my-4"}),i.jsxs(Nt,{className:"w-full mb-4",onClick:Z,disabled:c.filter((e=>0!==e.lat&&0!==e.lng)).length<2,children:[i.jsx(K,{className:"h-4 w-4 mr-2"}),"Get directions"]})]}),i.jsx(Rt,{}),i.jsx(Bt,{routeSummaries:k,selectedRouteId:M,onSelectRoute:e=>{R(e),t.current&&t.current.highlightRoute(e);const s=parseInt(e.replace("route-",""));if(w?.paths&&w.paths[s]){const e=w.paths[s];if(e.bbox&&4===e.bbox.length&&t.current){const[s,a,r,n]=e.bbox;t.current.fitBounds([[s,a],[r,n]])}}},onShowRouteDetails:()=>{if(!M||!w)return;const e=parseInt(M.replace("route-",""));w.paths&&w.paths[e]&&(T(w.paths[e]),_(!0))}})]})})})}));Yt.displayName="Direction";const qt=({x:e,y:t,lng:s,lat:a,isOpen:n,onClose:o,onGetLocation:l,onSetAsStart:c,onSetAsEnd:d,onAddWaypoint:u,showDirectionOptions:m=!1,canAddWaypoint:p=!1})=>{const[g,x]=r.useState(!0),f=r.useRef(null);r.useEffect((()=>{if(n){x(!0);const e=setTimeout((()=>x(!1)),100);return()=>clearTimeout(e)}}),[n]),r.useEffect((()=>{const e=e=>{f.current&&!f.current.contains(e.target)&&o()},t=e=>{"Escape"===e.key&&o()};return n&&(document.addEventListener("mousedown",e),document.addEventListener("keydown",t),document.addEventListener("contextmenu",e)),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t),document.removeEventListener("contextmenu",e)}}),[n,o]);const y=e=>e.toFixed(6);if(!n)return null;const v=Math.min(e,window.innerWidth-240),b=Math.min(t,window.innerHeight-250);return console.log("Rendering context menu at adjusted position:",{adjustedX:v,adjustedY:b,originalX:e,originalY:t}),i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"fixed inset-0 z-40 bg-transparent",onClick:o,onContextMenu:e=>{e.preventDefault(),o()}}),i.jsxs("div",{ref:f,className:"fixed z-50 w-56 rounded-md border bg-white p-1 shadow-md transition-all duration-100 "+(g?"animate-in fade-in zoom-in-95":""),style:{left:`${v}px`,top:`${b}px`},onContextMenu:e=>e.preventDefault(),children:[i.jsx("div",{className:"px-2 py-1.5 text-sm font-semibold text-gray-700 border-b",children:"Location"}),i.jsxs("button",{onClick:()=>{const e=`${a.toFixed(6)}, ${s.toFixed(6)}`;navigator.clipboard.writeText(e).then((()=>C.success("Coordinates copied to clipboard"))).catch((()=>C.error("Failed to copy coordinates"))),o()},className:"flex w-full items-center px-2 py-1.5 text-sm text-gray-700 hover:bg-gray-100 rounded cursor-pointer transition-colors",children:[i.jsx(ue,{className:"mr-2 h-4 w-4"}),i.jsxs("span",{children:[y(a),", ",y(s)]})]}),i.jsx("div",{className:"my-1 h-px bg-gray-200"}),i.jsxs("button",{onClick:()=>{l(s,a),o()},className:"flex w-full items-center px-2 py-1.5 text-sm text-gray-700 hover:bg-gray-100 rounded cursor-pointer transition-colors",children:[i.jsx(M,{className:"mr-2 h-4 w-4"}),i.jsx("span",{children:"Get location details"})]}),i.jsxs("button",{onClick:()=>{const e=`lat=${a.toFixed(6)}&lng=${s.toFixed(6)}`,t=`${window.location.origin}${window.location.pathname}?${e}`;navigator.clipboard.writeText(t).then((()=>C.success("Coordinates copied to clipboard"))).catch((()=>C.error("Failed to copy coordinates"))),o()},className:"flex w-full items-center px-2 py-1.5 text-sm text-gray-700 hover:bg-gray-100 rounded cursor-pointer transition-colors",children:[i.jsx(me,{className:"mr-2 h-4 w-4"}),i.jsx("span",{children:"Chia sẻ tọa độ"})]}),m&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"my-1 h-px bg-gray-200"}),i.jsxs("button",{onClick:()=>{c&&c(s,a),o()},className:"flex w-full items-center px-2 py-1.5 text-sm text-gray-700 hover:bg-gray-100 rounded cursor-pointer transition-colors",children:[i.jsx(K,{className:"mr-2 h-4 w-4 text-green-600"}),i.jsx("span",{children:"Chọn làm điểm bắt đầu"})]}),i.jsxs("button",{onClick:()=>{d&&d(s,a),o()},className:"flex w-full items-center px-2 py-1.5 text-sm text-gray-700 hover:bg-gray-100 rounded cursor-pointer transition-colors",children:[i.jsx(K,{className:"mr-2 h-4 w-4 text-red-600 rotate-180"}),i.jsx("span",{children:"Chọn làm điểm kết thúc"})]}),p&&i.jsxs("button",{onClick:()=>{u&&u(s,a),o()},className:"flex w-full items-center px-2 py-1.5 text-sm text-gray-700 hover:bg-gray-100 rounded cursor-pointer transition-colors",children:[i.jsx(de,{className:"mr-2 h-4 w-4 text-blue-600"}),i.jsx("span",{children:"Thêm điểm đến"})]})]}),i.jsx("div",{className:"my-1 h-px bg-gray-200"}),i.jsxs("button",{onClick:o,className:"flex w-full items-center px-2 py-1.5 text-sm text-red-600 hover:bg-red-50 rounded cursor-pointer transition-colors",children:[i.jsx(h,{className:"mr-2 h-4 w-4"}),i.jsx("span",{children:"Close"})]})]})]})},Xt=r.forwardRef((({className:e,...t},s)=>i.jsx("div",{ref:s,className:qe("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t})));Xt.displayName="Card",r.forwardRef((({className:e,...t},s)=>i.jsx("div",{ref:s,className:qe("flex flex-col space-y-1.5 p-6",e),...t}))).displayName="CardHeader",r.forwardRef((({className:e,...t},s)=>i.jsx("h3",{ref:s,className:qe("text-2xl font-semibold leading-none tracking-tight",e),...t}))).displayName="CardTitle",r.forwardRef((({className:e,...t},s)=>i.jsx("p",{ref:s,className:qe("text-sm text-muted-foreground",e),...t}))).displayName="CardDescription";const Gt=r.forwardRef((({className:e,...t},s)=>i.jsx("div",{ref:s,className:qe("p-6 pt-0",e),...t})));Gt.displayName="CardContent",r.forwardRef((({className:e,...t},s)=>i.jsx("div",{ref:s,className:qe("flex items-center p-6 pt-0",e),...t}))).displayName="CardFooter";const Zt=({place:e,onClose:t,onDirectionClick:s})=>{const[a,n]=r.useState(!0);return r.useEffect((()=>{const e=setTimeout((()=>n(!1)),100);return()=>clearTimeout(e)}),[]),i.jsx("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 z-30 w-full max-w-md",children:i.jsx(Xt,{className:"shadow-lg border-t-4 border-t-primary "+(a?"animate-in fade-in slide-in-from-bottom duration-100":""),children:i.jsxs(Gt,{className:"p-4 relative",children:[i.jsx("button",{onClick:t,className:"absolute top-2 right-2 rounded-full p-1 hover:bg-gray-100 transition-colors",children:i.jsx(h,{className:"h-4 w-4"})}),i.jsxs("div",{className:"mt-1",children:[i.jsx("h3",{className:"text-lg font-semibold text-primary",children:e.name||e.display.split(" ")[0]}),i.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.address}),i.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-3",children:[i.jsxs("div",{className:"text-xs",children:[i.jsx("span",{className:"block text-muted-foreground",children:"Coordinates"}),i.jsxs("span",{className:"font-medium",children:[e.lat.toFixed(6),", ",e.lng.toFixed(6)]})]}),i.jsxs("div",{className:"flex justify-end items-end gap-1",children:[i.jsxs(Nt,{variant:"outline",size:"sm",className:"gap-1",onClick:async()=>{console.log("Sharing place:",e);try{if(!e.ref_id)return void Ye({title:"Lỗi chia sẻ",description:"Không thể chia sẻ địa điểm này",variant:"destructive"});const t=`${window.location.origin}${window.location.pathname}?placeId=${e.ref_id}`;await navigator.clipboard.writeText(t),Ye({title:"Đã sao chép liên kết",description:"Liên kết chia sẻ đã được sao chép vào clipboard"})}catch(t){console.error("Error sharing place:",t),Ye({title:"Lỗi chia sẻ",description:"Không thể sao chép liên kết chia sẻ",variant:"destructive"})}},children:[i.jsx(me,{className:"h-4 w-4"}),"Chia sẻ"]}),s&&i.jsxs(Nt,{variant:"outline",size:"sm",className:"gap-1",onClick:s,children:[i.jsx(K,{className:"h-4 w-4"}),"Chỉ đường"]})]})]})]})]})})})},Jt=()=>{const e=ot(),{isSidebarOpen:t,showDirections:s}=it((e=>e.ui)),{selectedPlace:a,locationInfo:n,startingPlace:o}=it((e=>e.location)),{currentLayer:l,contextMenu:c}=it((e=>e.map)),d=r.useRef(null),u=r.useRef(null),m=r.useRef(null),{handleMapContextMenu:h,handleMapClick:p,handleCloseContextMenu:g}=(()=>{const e=ot(),{contextMenu:t}=it((e=>e.map)),{showDirections:s}=it((e=>e.ui)),{selectedPlace:a}=it((e=>e.location));return{handleMapContextMenu:r.useCallback((t=>{console.log("Context menu triggered at:",t.lngLat);let s=100,a=100;if(window.event){const e=window.event;s=e.clientX,a=e.clientY}console.log("Setting context menu at position:",{x:s,y:a}),e(ke({isOpen:!0,x:s,y:a,lng:t.lngLat[0],lat:t.lngLat[1]}))}),[e]),handleMapClick:r.useCallback((async(r,n)=>{try{if(t?.isOpen)return void e(Se());if(s)return;a&&e(Ie(null));const o=await yt(r.lngLat[0],r.lngLat[1]);e(ze(o)),n?.current&&(n.current.removeMarkers(),n.current.addMarker(r.lngLat[0],r.lngLat[1]))}catch(o){C.error("Failed to get location details"),console.error(o)}}),[t?.isOpen,s,a,e]),handleCloseContextMenu:r.useCallback((()=>{e(Se())}),[e])}})(),{handleGetLocation:x,handleSetAsStart:f,handleSetAsEnd:y,handleAddWaypoint:v}=(()=>{const e=ot();return{handleGetLocation:r.useCallback((async(t,s,a)=>{try{e(Ie(null));const r=await yt(t,s);e(ze(r)),a?.current&&(a.current.removeMarkers(),a.current.addMarker(t,s))}catch(r){C.error("Failed to get location details"),console.error(r)}}),[e]),handleSetAsStart:r.useCallback((async(t,s,a)=>{try{const r=await yt(t,s);e(De(r)),e(Te(!0)),e(Ie(null)),e(ze(null)),a?.current&&(a.current.removeMarkers(),a.current.removeRoutes())}catch(r){C.error("Failed to set starting point"),console.error(r)}}),[e]),handleSetAsEnd:r.useCallback((async(t,s,a,r)=>{try{const n=await yt(t,s);e(Te(!0)),e(Ie(null)),e(ze(null)),a?.current&&a.current.addMarker(t,s,"end"),r.current&&r.current.setEndPoint?r.current.setEndPoint(n):setTimeout((()=>{r.current&&r.current.setEndPoint&&r.current.setEndPoint(n)}),100)}catch(n){C.error("Failed to set end point"),console.error(n)}}),[e]),handleAddWaypoint:r.useCallback((async(e,t,s,a)=>{try{const r=await yt(e,t);a?.current&&a.current.addMarker(e,t,"waypoint"),s.current&&s.current.addWaypoint&&s.current.addWaypoint(r)}catch(r){C.error("Failed to add waypoint"),console.error(r)}}),[])}})(),{handleShowDirections:b,handleCloseDirections:w,handleDirectionMapClick:j}=(()=>{const e=ot(),{selectedPlace:t,locationInfo:s}=it((e=>e.location));return{handleShowDirections:r.useCallback((()=>{e(De(t||s)),e(Te(!0)),e(Ie(null)),e(ze(null))}),[e,t,s]),handleCloseDirections:r.useCallback((t=>{e(Te(!1)),e(De(null)),t.current&&(t.current.setMarkerDragCallback(null),t.current.removeMarkers(),t.current.removeRoutes())}),[e]),handleDirectionMapClick:r.useCallback((e=>!0),[])}})(),{handlePlaceSelect:N,handleClosePlaceDetails:k,handleCloseLocationInfo:S}=(()=>{const e=ot();return{handlePlaceSelect:r.useCallback(((t,s)=>{e(Ie(t)),e(Le(!1)),e(Te(!1)),e(ze(null)),s.current&&(s.current.flyTo(t.lng,t.lat),s.current.addMarker(t.lng,t.lat))}),[e]),handleClosePlaceDetails:r.useCallback((t=>{e(Ie(null)),t.current&&t.current.removeMarkers()}),[e]),handleCloseLocationInfo:r.useCallback((t=>{e(ze(null)),t.current&&t.current.removeMarkers()}),[e]),handleSharePlace:r.useCallback((async e=>{try{if(console.log("Sharing place:",e),!e.ref_id)return void Ye({title:"Lỗi chia sẻ",description:"Không thể chia sẻ địa điểm này",variant:"destructive"});const t=`${window.location.origin}${window.location.pathname}?placeId=${e.ref_id}`;await navigator.clipboard.writeText(t),Ye({title:"Đã sao chép liên kết",description:"Liên kết chia sẻ đã được sao chép vào clipboard"})}catch(t){console.error("Error sharing place:",t),Ye({title:"Lỗi chia sẻ",description:"Không thể sao chép liên kết chia sẻ",variant:"destructive"})}}),[])}})();vt(d);const M=()=>{k(d)},R=()=>{b()},E=s&&u.current?.hasValidInputs?.(),_=r.useCallback((e=>p(e,d)),[p]);return r.useEffect((()=>{s&&u.current&&d.current?d.current.setMarkerDragCallback(((e,t,s)=>{u.current&&u.current.updateWaypointCoordinates&&u.current.updateWaypointCoordinates(e,t,s)})):d.current&&d.current.setMarkerDragCallback(null)}),[s]),r.useEffect((()=>{d.current&&e(Ce(d.current))}),[e]),i.jsxs("div",{className:"relative w-full h-screen overflow-hidden bg-gray-50",children:[i.jsx(wt,{ref:d,className:"absolute inset-0 mapContainer",onContextMenu:h,onClick:_,initialMapStyle:l,onMapStyleChange:t=>{e(Ne(t))}}),i.jsx("div",{className:"absolute top-0 left-0 right-0 z-50",children:!s&&i.jsx(Mt,{mapRef:d,onMenuToggle:()=>{e(Ee(!t))},isMenuOpen:t,onPlaceSelect:e=>{N(e,d)},onClose:M})}),a&&!n&&i.jsx("div",{className:"absolute top-0 left-0 bottom-0 z-40",children:i.jsx(Ot,{place:a,onClose:M,onDirectionClick:R})}),n&&!a&&i.jsx("div",{className:"absolute  left-0 right-0 bottom-0 z-40",children:i.jsx(Zt,{place:n,onClose:()=>{S(d)},onDirectionClick:R})}),s&&i.jsx(Yt,{ref:u,onClose:()=>{w(d)},mapRef:d,startingPlace:o,onMapClick:e=>(m.current=e,j(e))}),i.jsx(Et,{isOpen:t,onClose:()=>{e(Ee(!1))}}),i.jsx(Lt,{mapRef:d,onLayerChange:t=>{d.current&&(d.current.setMapStyle(t),e(Ne(t)))},currentLayer:l}),c&&c.isOpen&&i.jsx(qt,{x:c.x,y:c.y,lng:c.lng,lat:c.lat,isOpen:c.isOpen,onClose:g,onGetLocation:(e,t)=>x(e,t,d),onSetAsStart:(e,t)=>f(e,t,d),onSetAsEnd:(e,t)=>y(e,t,d,u),onAddWaypoint:(e,t)=>v(e,t,u,d),showDirectionOptions:!0,canAddWaypoint:E}),t&&i.jsx("div",{className:"absolute inset-0 z-20 bg-black bg-opacity-10",onClick:()=>e(Ee(!1))})]})},Qt=()=>{const e=he();return r.useEffect((()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)}),[e.pathname]),i.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:i.jsxs("div",{className:"text-center",children:[i.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),i.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),i.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},es=new pe;nt.initialize();const ts=()=>i.jsx(ge,{store:Ve,children:i.jsx(xe,{client:es,children:i.jsxs(rt,{children:[i.jsx(st,{}),i.jsx(at,{}),i.jsx(fe,{children:i.jsxs(ye,{children:[i.jsx(ve,{path:"/",element:i.jsx(Jt,{})}),i.jsx(ve,{path:"*",element:i.jsx(Qt,{})})]})})]})})});be(document.getElementById("root")).render(i.jsx(we.StrictMode,{children:i.jsx(ts,{})}));
